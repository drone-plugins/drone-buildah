FROM quay.io/buildah/stable:v1.36.0

# Set up the working directory
USER build
WORKDIR /home/build

# Copy the custom containers.conf
COPY containers.conf /home/build/.config/containers/containers.conf

# Set XDG_CONFIG_HOME to point to the correct config directory
ENV XDG_CONFIG_HOME=/home/build/.config

# Add the plugin binary
ADD release/linux/amd64/drone-docker /bin/

# Set the entrypoint to the plugin binary
ENTRYPOINT ["/bin/drone-docker"]
